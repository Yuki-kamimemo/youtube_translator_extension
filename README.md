# YouTube Live Chat Enhancer

## 概要

**YouTube Live Chat Enhancer** は、YouTubeのライブ配信やプレミア公開のチャットをより楽しむための多機能拡張機能です。海外の配信をリアルタイムで楽しみたい時や、たくさんのコメントを追いかけたい時に役立ちます。

主な機能は以下の通りです。

*   **リアルタイム翻訳**: 外国語のチャットコメントを日本語に自動で翻訳します。
*   **フローコメント**: 翻訳したコメントや元のコメントを、ニコニコ動画のように画面上に流して表示します。
*   **高度なカスタマイズ**: コメントの表示スタイル（フォント、色、速度など）を自由に変更できます。
*   **NG機能**: 特定のユーザーやキーワードを含むコメントを非表示にできます。
*   **プロファイル管理**: よく使う設定を保存し、いつでも切り替えることができます。

## インストール方法

1.  この拡張機能のフォルダをダウンロードします。
2.  Google Chromeを開き、アドレスバーに `chrome://extensions` と入力して拡張機能管理ページを開きます。
3.  ページの右上にある「デベロッパーモード」をオンにします。
4.  「パッケージ化されていない拡張機能を読み込む」ボタンをクリックし、ダウンロードした拡張機能のフォルダを選択します。
5.  ツールバーに拡張機能のアイコンが表示されればインストール完了です。

## 使い方

### 1. 設定パネルを開く

YouTubeの動画ページ（ライブ配信またはプレミア公開）を開くと、チャット欄の上部に3つのボタンが追加されます。

*   **🌐 (翻訳)**: チャット欄内でのインライン翻訳のオン/オフを切り替えます。
*   **💬 (コメント表示)**: 画面上にコメントを流す機能（フローコメント）のオン/オフを切り替えます。
*   **⚙️ (詳細設定)**: 詳細な設定パネルを開きます。

### 2. 基本的な設定

「⚙️」ボタンを押すと、設定パネルが表示されます。このパネルはドラッグして好きな位置に移動できます。

#### 翻訳サービスの設定

*   **翻訳サービス**: 使用する翻訳エンジンを選択します。
    *   **Google翻訳**: APIキー不要で手軽に利用できます。
    *   **Gemini / DeepL**: より高品質な翻訳が必要な場合に使用します。利用には各サービスで取得したAPIキーが必要です。キーを入力すると、自動的にそのサービスが使われます。
*   **APIキー**: GeminiまたはDeepLを選択した場合、対応するAPIキーを入力してください。キーはパスワード形式で隠されます。
    *   Geminiは2つのキーを登録でき、交互に使用することでAPIの負荷を分散します。
*   **フォールバック**: APIキー利用サービスで上限に達した場合、自動でGoogle翻訳に切り替えるかを選択できます。

#### 機能のオン・オフ

*   **チャット欄に翻訳を表示**: インライン翻訳機能の有効/無効を切り替えます。
*   **画面にコメントを流す**: フローコメント機能の有効/無効を切り替えます。

### 3. フローコメントの詳細設定

フローコメントを有効にしている場合、その表示方法を細かく設定できます。

*   **流す内容**: 「翻訳文のみ」「原文のみ」「原文と翻訳文の両方」から選択します。
*   **速度**: コメントが画面を流れる速さを秒単位で設定します。
*   **サイズ・透過度**: フォントの大きさと背景の透明度を調整します。
*   **表示方法**: コメントが画面の上から、下から、またはランダムな位置に表示されるかを選べます。
*   **マージン**: 画面の上下にどれくらいの余白を設けるかを設定します。
*   **フォント**: コメントのフォントを選択したり、好きなフォント名を直接入力したりできます。
*   **色設定**: 通常、メンバー、モデレーター、スーパーチャットなど、投稿者の種類に応じてコメントの色を個別に設定できます。

### 4. NG設定

見たくないコメントを非表示にできます。

*   **NGユーザー**: 非表示にしたいユーザーの名前を1行に1人ずつ入力します。
*   **NGワード**: 非表示にしたい単語を1行に1つずつ入力します。

### 5. プロファイル管理

配信者や視聴するコンテンツに合わせて設定を保存し、簡単に切り替えることができます。

*   **保存**: 現在の設定に名前を付けて保存します。
*   **読み込み**: 保存したプロファイルを選択して、設定を一度に読み込みます。
*   **削除**: 不要になったプロファイルを削除します。

## 技術的な詳細

この拡張機能は、以下のファイルで構成されています。

*   `manifest.json`: 拡張機能の基本的な定義ファイル。
*   `content_script.js`: YouTubeのページに挿入され、チャットの監視、DOM操作、UIの追加など、中核的な処理を行います。
*   `popup.html` / `popup.js`: 詳細設定パネルのUIとロジックを担います。
*   `flow.js`: 画面上にコメントを流すフローコメント機能の実装です。
*   `translation.js`: 各翻訳APIとの通信を処理します。
*   `background.js`: バックグラウンドで動作し、イベントを管理します。
*   `content_script.css`: ページに挿入するUIのスタイルを定義します。

## Google翻訳の精度を上げるための改善ポイント

この拡張機能では、Google翻訳利用時の品質を上げるために次の方針が有効です。

1. **分割翻訳の結合品質を上げる（実装済み）**
   * Google翻訳レスポンスの文節を先頭1つだけ採用するのではなく、返却された全セグメントを結合して最終訳文を作るようにしています。
   * 複数文コメントや改行を含むコメントで、訳抜けが起きにくくなります。

2. **辞書の前処理を「用語固定」に使う（既存機能の活用）**
   * 固有名詞（配信者名、ゲーム内用語、ミーム語）を辞書で置換してから翻訳に渡すと、誤訳が減ります。
   * 特に配信コミュニティ固有の略語は、辞書登録の効果が高いです。

3. **短文・ノイズ文のスキップルールを継続調整する（運用改善）**
   * `translation.js` のスキップ判定を配信ジャンルごとに微調整し、翻訳対象の純度を上げると全体品質が向上します。
   * 例: 1文字英字や絵文字だけの発言、URLのみの発言など。

4. **長文チャットの文脈分割（今後の拡張候補）**
   * 一定文字数を超える場合に句点・改行で分割翻訳し、再結合することで誤訳・欠落を抑えられます。
   * 将来的に「長文最適化モード」として設定化すると、低遅延と高品質のバランスを取りやすくなります。
